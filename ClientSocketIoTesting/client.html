<!-- 
    To run the Client SocketIoTesting project: 
    -> run 'parcel client.html' in the command line
    see http://localhost:1234/
-->
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    function init() {
        output = document.getElementById("output");
        testSocket();
    }

    function testSocket() {
        var socket = io.connect('http://localhost:8080');
        // var socket = io.connect('https://projet-3-228722.appspot.com/');

        socket.on('connect', onConnect);
        socket.on('hello', onHello);
        socket.on('disconnect', onDisconnect);
        socket.on('connect_error', onError);
        socket.on('reconnect_error', onError);

        socket.on('userCreated', onUserCreated);

        function onConnect(evt) {
            writeToScreen("CONNECTED");
            //var myObject = {
            //    username: 'TEST',
            //    password: 'TEST'
            //};
			
			//var myObject = "{\"username\": \"TEST\", \"password\": \"Mondga\" }";

            // socket.emit("createChatroom", "TESTING");
            // socket.on("createChatroomResponse", response);
            //let temp = Date.now();
            //socket.emit("sendMessage", temp);

            //socket.on('messageSent', response);  
			// socket.emit("getChatroomClients", "TESTING");
			// socket.on("getChatroomClientsResponse", response);


            socket.emit("joinDrawingTest");
            socket.on('joinDrawingTestResponse', response);

            socket.emit("drawingUpdateTest", "TESTING");
            socket.on('drawingUpdateTestResponse', response);


            
            socket.emit("drawingUpdateTest", "TESTING");
            socket.on('drawingUpdateTestResponse', response);

            socket.emit("drawingUpdateTest", "TESTING");
            socket.on('drawingUpdateTestResponse', response);
        }


        function response(evt) {
            writeToScreen(evt);
        }

        function onUserCreated(evt) {
            writeToScreen("USER CREATED");
        }

        function onHello(evt) {
            writeToScreen("HELLO!");
        }

        function onDisconnect(evt) {
            writeToScreen("DISCONNECTED");
        }

        function onMessage(data) {
            writeToScreen('<span style="color: blue;">RESPONSE: ' + data + '</span>');
            socket.close();
        }

        function onError(message) {
            writeToScreen('<span style="color: red;">ERROR:</span> ' + message);
        }

        function doSend(message) {
            writeToScreen("SENT: " + message);
            socket.emit('test', message);
        }

        function writeToScreen(message) {
            var pre = document.createElement("p");
            pre.style.wordWrap = "break-word";
            pre.innerHTML = message;
            output.appendChild(pre);
        }
    }
    window.addEventListener("load", init, false);
</script>

<h2>Socket.io Test</h2>
<div id="output"></div>